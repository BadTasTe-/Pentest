#!/usr/bin/env python

import socket, select

tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#reusable address if loosing the connection
tcpSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
tcpSocket.bind(('0.0.0.0', 8000))
tcpSocket.listen(10)

print "Waiting for client..."

holeinsock = []

while True:
	read, write, ex = select.select([tcpSocket]+ holeinsock, [], [])
	for s in read:
		if s is tcpSocket:
			(client, (ip,port)) =tcpSocket.accept()
			print "Received a connection from IP %s on port %s" %(str(ip),str(port))
			print "Startinfg ECHO output..."
			holeinsock.append(client)
		else:
			data = s.recv(16)
			if data == "":
				holeinsock.remove(s)
				print "closing connection!"
			else:
				print "Received this from IP %s  on port %s: %s" %(str(ip), str(port), str(data))
				client.send("Client you sent the server : %s" %str(data))

