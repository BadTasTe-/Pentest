#!/usr/bin/env python

import socket
from multiprocessing import Process
import sys

def echoClientHandler(clientSocket, addr):
	while 1:
		client_data=clientSocket.recv(2048)
		if client_data:
			print "User with IP %s says: %s" %(str(addr), str(client_data))
			clientSocket.send("Msg sent")
		else:
			clientSocket.close()

tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#reusable address if loosing the connection
tcpSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
tcpSocket.bind(('0.0.0.0', 8000))
tcpSocket.listen(10)
workerProcess=[]

while 1:
	cSock, addr = tcpSocket.accept()
	print "Starting New Thread to service Client \n"
	worker = Process(target=echoClientHandler, args= (cSock, addr))
	worker.start()
	workerProcess.append(worker)
